<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1969 Camaro Hunter HQ</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --red: #C8281E;
  --red-dark: #9B1B13;
  --cream: #F2EDE3;
  --black: #0C0B09;
  --steel: #252220;
  --gold: #C9A84C;
  --smoke: #6E6860;
  --card: #131210;
  --border: #222018;
  --green: #3D9E68;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--black);
  color: var(--cream);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
}

/* â”€â”€ HEADER â”€â”€ */
.header {
  background: #0A0908;
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  display: flex; align-items: center;
  height: 64px; gap: 24px; position: sticky; top: 0; z-index: 100;
}
.logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 24px; letter-spacing: 0.06em; color: var(--cream);
  display: flex; align-items: center; gap: 10px; white-space: nowrap;
}
.logo span { color: var(--red); }

.header-stats {
  display: flex; gap: 20px; align-items: center;
  border-left: 1px solid var(--border); padding-left: 24px;
}
.hstat { display: flex; flex-direction: column; align-items: center; }
.hstat-num { font-family: 'Bebas Neue', sans-serif; font-size: 22px; line-height: 1; color: var(--gold); }
.hstat-label { font-size: 9px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--smoke); }

.live-pill {
  display: flex; align-items: center; gap: 6px;
  background: rgba(61,158,104,0.12);
  border: 1px solid rgba(61,158,104,0.3);
  border-radius: 20px; padding: 4px 12px;
  font-size: 11px; color: var(--green); font-weight: 600;
}
.live-dot {
  width: 7px; height: 7px; border-radius: 50%; background: var(--green);
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.8)} }

.header-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
.updated-text { font-size: 12px; color: var(--smoke); white-space: nowrap; }

.refresh-btn {
  padding: 8px 18px;
  background: var(--red); color: white; border: none; cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  font-size: 11px; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;
  border-radius: 3px; transition: background 0.2s; white-space: nowrap;
  display: flex; align-items: center; gap: 6px;
}
.refresh-btn:hover { background: var(--red-dark); }
.refresh-btn svg { transition: transform 0.5s; }
.refresh-btn.spinning svg { animation: spin 0.7s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ FILTERS â”€â”€ */
.filters {
  padding: 16px 32px;
  display: flex; align-items: center; gap: 10px;
  background: #0e0c0a; border-bottom: 1px solid var(--border);
  flex-wrap: wrap;
}
.filter-btn {
  padding: 7px 16px;
  background: transparent; border: 1px solid var(--border);
  color: var(--smoke); cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  font-size: 11px; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase;
  border-radius: 2px; transition: all 0.15s; white-space: nowrap;
}
.filter-btn:hover { color: var(--cream); border-color: var(--steel); }
.filter-btn.active { background: var(--red); color: white; border-color: var(--red); }

.new-only-toggle {
  display: flex; align-items: center; gap: 8px;
  margin-left: auto; cursor: pointer;
  font-size: 12px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase;
  color: var(--smoke); user-select: none;
}
.new-only-toggle input { accent-color: var(--red); width: 16px; height: 16px; cursor: pointer; }
.new-only-toggle.on { color: var(--red); }

.sort-select {
  background: var(--card); border: 1px solid var(--border);
  color: var(--smoke); padding: 7px 12px;
  font-family: 'DM Sans', sans-serif; font-size: 11px;
  border-radius: 2px; cursor: pointer; letter-spacing: 0.04em;
}

/* â”€â”€ MAIN GRID â”€â”€ */
.main { padding: 28px 32px 80px; }

.section-label {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 13px; letter-spacing: 0.2em; text-transform: uppercase;
  color: var(--smoke); margin-bottom: 16px;
  display: flex; align-items: center; gap: 12px;
}
.section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
  gap: 16px;
}

/* â”€â”€ LISTING CARD â”€â”€ */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 4px; overflow: hidden;
  display: flex; flex-direction: column;
  transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
  animation: fadeUp 0.4s ease-out both;
  cursor: pointer;
  position: relative;
}
.card:hover {
  border-color: #383330;
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
}
.card.is-new {
  border-color: rgba(200,40,30,0.4);
  box-shadow: 0 0 0 1px rgba(200,40,30,0.15);
}
.card.is-new:hover { border-color: var(--red); }

@keyframes fadeUp {
  from { opacity:0; transform:translateY(16px); }
  to { opacity:1; transform:translateY(0); }
}

/* Card image */
.card-img {
  width: 100%; height: 190px; position: relative; overflow: hidden;
  background: #1a1815; flex-shrink: 0;
}
.card-img img {
  width: 100%; height: 100%; object-fit: cover;
  transition: transform 0.4s ease;
}
.card:hover .card-img img { transform: scale(1.04); }
.card-img-placeholder {
  width: 100%; height: 100%;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 10px; color: #333;
}
.card-img-placeholder svg { color: #2a2825; }
.card-img-placeholder span { font-size: 12px; color: var(--smoke); }

/* Badges */
.badge-new {
  position: absolute; top: 10px; left: 10px;
  background: var(--red); color: white;
  font-size: 10px; font-weight: 800; letter-spacing: 0.15em; text-transform: uppercase;
  padding: 4px 10px; border-radius: 2px;
  animation: newPulse 2s ease-in-out 3;
}
@keyframes newPulse {
  0%,100%{box-shadow:0 0 0 0 rgba(200,40,30,0.5)}
  50%{box-shadow:0 0 0 6px rgba(200,40,30,0)}
}
.badge-source {
  position: absolute; bottom: 10px; left: 10px;
  background: rgba(0,0,0,0.75); color: var(--cream);
  font-size: 10px; font-weight: 600; letter-spacing: 0.08em;
  padding: 3px 8px; border-radius: 2px;
  backdrop-filter: blur(4px);
}
.badge-auction {
  position: absolute; top: 10px; right: 10px;
  background: rgba(201,168,76,0.9); color: #0a0800;
  font-size: 10px; font-weight: 800; letter-spacing: 0.1em;
  padding: 3px 8px; border-radius: 2px;
}

/* Card body */
.card-body { padding: 14px 16px; flex: 1; display: flex; flex-direction: column; gap: 8px; }
.card-title {
  font-size: 14px; font-weight: 600; color: var(--cream); line-height: 1.4;
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.card-price {
  font-family: 'Bebas Neue', sans-serif; font-size: 26px;
  color: var(--gold); letter-spacing: 0.04em; line-height: 1;
}
.card-price.no-price { font-size: 14px; color: var(--smoke); font-family: 'DM Sans', sans-serif; font-weight: 400; }
.card-price.is-auction { color: var(--green); font-size: 15px; font-family: 'DM Sans', sans-serif; font-weight: 600; }

.card-meta {
  display: flex; align-items: center; justify-content: space-between;
  font-size: 11px; color: var(--smoke);
}
.card-location { display: flex; align-items: center; gap: 4px; }
.card-age { color: var(--smoke); }
.card-age.fresh { color: var(--green); font-weight: 600; }

.card-footer {
  margin-top: auto; padding-top: 12px;
  border-top: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.card-link {
  font-size: 11px; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase;
  color: var(--red); text-decoration: none;
  display: flex; align-items: center; gap: 5px;
  transition: color 0.15s;
}
.card-link:hover { color: #e03025; }
.save-btn {
  background: none; border: none; cursor: pointer;
  font-size: 13px; color: var(--smoke); transition: color 0.15s;
  display: flex; align-items: center; gap: 4px;
  font-family: 'DM Sans', sans-serif; font-size: 11px; font-weight: 500;
}
.save-btn:hover, .save-btn.saved { color: var(--gold); }

/* â”€â”€ STATES â”€â”€ */
.loading-state, .error-state, .empty-state {
  grid-column: 1/-1; padding: 80px 0;
  display: flex; flex-direction: column; align-items: center; gap: 16px;
  color: var(--smoke); text-align: center;
}
.spinner {
  width: 40px; height: 40px; border-radius: 50%;
  border: 3px solid var(--steel); border-top-color: var(--red);
  animation: spin 0.8s linear infinite;
}
.empty-title { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: var(--steel); }
.error-msg { font-size: 14px; max-width: 400px; line-height: 1.6; }

/* â”€â”€ NEW BANNER â”€â”€ */
.new-banner {
  background: rgba(200,40,30,0.08);
  border: 1px solid rgba(200,40,30,0.2);
  border-radius: 4px; padding: 14px 20px;
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 20px; animation: fadeUp 0.3s ease-out;
}
.new-banner-count {
  font-family: 'Bebas Neue', sans-serif; font-size: 40px; color: var(--red); line-height: 1;
}
.new-banner-text { font-size: 14px; line-height: 1.5; }
.new-banner-text strong { color: var(--cream); }
.new-banner-text span { color: var(--smoke); }
.dismiss-btn {
  margin-left: auto; background: none; border: 1px solid var(--border);
  color: var(--smoke); cursor: pointer; padding: 6px 14px;
  font-size: 11px; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase;
  border-radius: 2px; transition: all 0.15s; font-family: 'DM Sans', sans-serif;
}
.dismiss-btn:hover { color: var(--cream); border-color: var(--smoke); }

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 700px) {
  .header { padding: 0 16px; gap: 12px; }
  .header-stats { display: none; }
  .filters { padding: 12px 16px; }
  .main { padding: 20px 16px 60px; }
  .grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="logo">ðŸš— <span>1969</span> Camaro HQ</div>
  <div class="header-stats">
    <div class="hstat"><div class="hstat-num" id="h-total">â€”</div><div class="hstat-label">Total</div></div>
    <div class="hstat"><div class="hstat-num" id="h-new" style="color:var(--red)">â€”</div><div class="hstat-label">New Today</div></div>
    <div class="hstat"><div class="hstat-num" id="h-sources">5</div><div class="hstat-label">Sources</div></div>
  </div>
  <div class="live-pill"><div class="live-dot"></div> Auto-updated daily</div>
  <div class="header-right">
    <span class="updated-text" id="updated-text">Loading...</span>
    <button class="refresh-btn" id="refresh-btn" onclick="loadListings()">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
      </svg>
      Refresh
    </button>
  </div>
</header>

<!-- FILTERS -->
<div class="filters">
  <button class="filter-btn active" onclick="setFilter('all',this)">All</button>
  <button class="filter-btn" onclick="setFilter('new',this)">ðŸ”´ New Only</button>
  <button class="filter-btn" onclick="setFilter('auction',this)">Auctions</button>
  <button class="filter-btn" onclick="setFilter('buynow',this)">Buy It Now</button>
  <button class="filter-btn" onclick="setFilter('under10',this)">Under $10k</button>
  <button class="filter-btn" onclick="setFilter('under25',this)">Under $25k</button>
  <button class="filter-btn" onclick="setFilter('ebay',this)">eBay</button>
  <button class="filter-btn" onclick="setFilter('hemmings',this)">Hemmings</button>
  <button class="filter-btn" onclick="setFilter('classiccars',this)">ClassicCars</button>
  <button class="filter-btn" onclick="setFilter('bat',this)">BaT</button>
  <select class="sort-select" id="sort-select" onchange="render()">
    <option value="new-first">New First</option>
    <option value="price-low">Price: Low â†’ High</option>
    <option value="price-high">Price: High â†’ Low</option>
    <option value="recent">Most Recent</option>
  </select>
</div>

<!-- MAIN -->
<main class="main">
  <div id="new-banner" style="display:none" class="new-banner">
    <div class="new-banner-count" id="banner-count">0</div>
    <div class="new-banner-text">
      <strong>New listings found since last visit!</strong><br>
      <span>Scroll down â€” new listings are highlighted in red and shown first.</span>
    </div>
    <button class="dismiss-btn" onclick="dismissBanner()">Mark All Seen</button>
  </div>

  <div id="section-new" style="display:none">
    <div class="section-label">New Since Last Visit</div>
    <div class="grid" id="grid-new"></div>
    <div style="height:32px"></div>
  </div>

  <div id="section-all">
    <div class="section-label" id="section-all-label">All Listings</div>
    <div class="grid" id="grid-all">
      <div class="loading-state">
        <div class="spinner"></div>
        <div>Loading listings...</div>
      </div>
    </div>
  </div>
</main>

<script>
// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let allListings = [];
let activeFilter = 'all';
let savedIds = new Set(JSON.parse(localStorage.getItem('camaro_saved_ids') || '[]'));
let seenIds   = new Set(JSON.parse(localStorage.getItem('camaro_seen_ids') || '[]'));

// â”€â”€ LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadListings() {
  const btn = document.getElementById('refresh-btn');
  btn.classList.add('spinning');
  document.getElementById('updated-text').textContent = 'Loading...';

  try {
    // Cache-bust so we always get the latest file
    const res = await fetch(`listings.json?t=${Date.now()}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    allListings = data.listings || [];

    // Mark listings as new if we haven't seen their ID before
    allListings.forEach(l => {
      l.is_new = !seenIds.has(l.id);
    });

    const newCount = allListings.filter(l => l.is_new).length;

    // Update header stats
    document.getElementById('h-total').textContent = allListings.length;
    document.getElementById('h-new').textContent = newCount;

    // Updated time
    const d = new Date(data.updated_at);
    document.getElementById('updated-text').textContent =
      'Updated ' + d.toLocaleString([], {month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});

    // Show banner if there are new listings
    if (newCount > 0) {
      document.getElementById('new-banner').style.display = 'flex';
      document.getElementById('banner-count').textContent = newCount;
    }

    render();

  } catch (err) {
    document.getElementById('grid-all').innerHTML = `
      <div class="error-state">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#333" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        <div class="empty-title">Couldn't Load</div>
        <div class="error-msg">
          The listings file hasn't been generated yet. You need to run the scraper first via GitHub Actions.<br><br>
          Go to your GitHub repo â†’ Actions tab â†’ "1969 Camaro Tracker" â†’ "Run workflow".
        </div>
        <button class="filter-btn" style="margin-top:8px" onclick="loadListings()">Try Again</button>
      </div>`;
    document.getElementById('updated-text').textContent = 'Failed to load';
  }

  btn.classList.remove('spinning');
}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  let filtered = [...allListings];
  const sort = document.getElementById('sort-select').value;

  // Filter
  const f = activeFilter;
  if (f === 'new')        filtered = filtered.filter(l => l.is_new);
  if (f === 'auction')    filtered = filtered.filter(l => l.is_auction);
  if (f === 'buynow')     filtered = filtered.filter(l => !l.is_auction);
  if (f === 'under10')    filtered = filtered.filter(l => l.price_num > 0 && l.price_num < 10000);
  if (f === 'under25')    filtered = filtered.filter(l => l.price_num > 0 && l.price_num < 25000);
  if (f === 'ebay')       filtered = filtered.filter(l => l.source === 'eBay Motors');
  if (f === 'hemmings')   filtered = filtered.filter(l => l.source === 'Hemmings');
  if (f === 'classiccars')filtered = filtered.filter(l => l.source === 'ClassicCars.com');
  if (f === 'bat')        filtered = filtered.filter(l => l.source === 'BringATrailer');

  // Sort
  if (sort === 'new-first')  filtered.sort((a,b) => (b.is_new - a.is_new) || new Date(b.fetched_at) - new Date(a.fetched_at));
  if (sort === 'price-low')  filtered.sort((a,b) => (a.price_num||999999) - (b.price_num||999999));
  if (sort === 'price-high') filtered.sort((a,b) => (b.price_num||0) - (a.price_num||0));
  if (sort === 'recent')     filtered.sort((a,b) => new Date(b.fetched_at||0) - new Date(a.fetched_at||0));

  const newOnes = filtered.filter(l => l.is_new);
  const oldOnes = filtered.filter(l => !l.is_new);

  // New section
  if (newOnes.length > 0 && f === 'all') {
    document.getElementById('section-new').style.display = 'block';
    document.getElementById('grid-new').innerHTML = newOnes.map((l,i) => cardHTML(l,i)).join('');
    document.getElementById('section-all-label').textContent = 'Previously Seen';
  } else {
    document.getElementById('section-new').style.display = 'none';
    document.getElementById('section-all-label').textContent = 'All Listings';
  }

  // Main section
  const toShow = f === 'all' ? oldOnes : filtered;
  if (toShow.length === 0 && filtered.length === 0) {
    document.getElementById('grid-all').innerHTML = `
      <div class="empty-state">
        <div class="empty-title">No Listings Found</div>
        <div style="font-size:13px">Try a different filter or run the scraper again.</div>
      </div>`;
  } else {
    document.getElementById('grid-all').innerHTML = toShow.map((l,i) => cardHTML(l, i + newOnes.length)).join('');
  }
}

// â”€â”€ CARD HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cardHTML(l, idx) {
  const isSaved = savedIds.has(l.id);
  const age = timeAgo(l.fetched_at);
  const isFresh = l.fetched_at && (Date.now() - new Date(l.fetched_at)) < 86400000;

  const priceHTML = l.is_auction
    ? `<div class="card-price is-auction">ðŸ”¨ ${l.price || 'Auction â€” place a bid'}</div>`
    : l.price
      ? `<div class="card-price">${l.price}</div>`
      : `<div class="card-price no-price">Price not listed</div>`;

  const imgHTML = l.image
    ? `<img src="${l.image}" alt="${l.title}" loading="lazy"
         onerror="this.parentNode.innerHTML='<div class=\\'card-img-placeholder\\'><svg width=\\'48\\' height=\\'48\\' viewBox=\\'0 0 24 24\\' fill=\\'none\\' stroke=\\'currentColor\\' stroke-width=\\'1\\'><rect x=\\'3\\' y=\\'3\\' width=\\'18\\' height=\\'18\\' rx=\\'2\\'/><circle cx=\\'8.5\\' cy=\\'8.5\\' r=\\'1.5\\'/><path d=\\'M21 15l-5-5L5 21\\'/></svg><span>No photo</span></div>'">`
    : `<div class="card-img-placeholder">
         <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
         <span>No photo</span>
       </div>`;

  return `
  <div class="card ${l.is_new ? 'is-new' : ''}"
       style="animation-delay:${Math.min(idx * 0.03, 0.5)}s"
       onclick="window.open('${l.url}','_blank');markSeen('${l.id}')">
    <div class="card-img">
      ${imgHTML}
      ${l.is_new ? '<div class="badge-new">âœ¦ New</div>' : ''}
      ${l.is_auction ? '<div class="badge-auction">AUCTION</div>' : ''}
      <div class="badge-source">${l.source}</div>
    </div>
    <div class="card-body">
      <div class="card-title">${l.title}</div>
      ${priceHTML}
      <div class="card-meta">
        <div class="card-location">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/>
          </svg>
          ${l.location || 'United States'}
        </div>
        <div class="card-age ${isFresh ? 'fresh' : ''}">${age}</div>
      </div>
      <div class="card-footer">
        <a class="card-link" href="${l.url}" target="_blank"
           onclick="event.stopPropagation();markSeen('${l.id}')">
          View Listing
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
            <polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </a>
        <button class="save-btn ${isSaved ? 'saved' : ''}"
                onclick="event.stopPropagation();toggleSave('${l.id}')"
                id="save-${l.id}">
          ${isSaved ? 'â˜… Saved' : 'â˜† Save'}
        </button>
      </div>
    </div>
  </div>`;
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function timeAgo(iso) {
  if (!iso) return '';
  const diff = Date.now() - new Date(iso);
  const h = Math.floor(diff / 3600000);
  if (h < 1)  return 'Just now';
  if (h < 24) return `${h}h ago`;
  const d = Math.floor(h / 24);
  if (d < 7)  return `${d}d ago`;
  return `${Math.floor(d/7)}w ago`;
}

function setFilter(f, btn) {
  activeFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function markSeen(id) {
  seenIds.add(id);
  localStorage.setItem('camaro_seen_ids', JSON.stringify([...seenIds]));
  // Remove new badge from that card
  const card = document.getElementById(`save-${id}`)?.closest('.card');
  if (card) {
    card.classList.remove('is-new');
    card.querySelector('.badge-new')?.remove();
  }
}

function dismissBanner() {
  allListings.forEach(l => {
    seenIds.add(l.id);
    l.is_new = false;
  });
  localStorage.setItem('camaro_seen_ids', JSON.stringify([...seenIds]));
  document.getElementById('new-banner').style.display = 'none';
  document.getElementById('h-new').textContent = '0';
  render();
}

function toggleSave(id) {
  if (savedIds.has(id)) {
    savedIds.delete(id);
  } else {
    savedIds.add(id);
  }
  localStorage.setItem('camaro_saved_ids', JSON.stringify([...savedIds]));
  const btn = document.getElementById(`save-${id}`);
  if (btn) {
    btn.className = `save-btn ${savedIds.has(id) ? 'saved' : ''}`;
    btn.textContent = savedIds.has(id) ? 'â˜… Saved' : 'â˜† Save';
  }
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadListings();
</script>
</body>
</html>
